MONGODB & NODE.JS CONCEPTS USED IN THIS PROJECT
==============================================

This project uses many core concepts from MongoDB, Mongoose, and Node.js. Below is a summary with **file names + code samples**.


1) Mongoose Schemas & Models
----------------------------

Files:
- `Backend/models/user.model.js`
- `Backend/models/product.model.js`
- `Backend/models/order.model.js`
- `Backend/models/review.model.js`
- `Backend/models/notification.model.js`
- `Backend/models/settings.model.js`

Example: `Backend/models/product.model.js`

```js
import mongoose from "mongoose";

const productSchema = new mongoose.Schema(
  {
    name: { type: String, required: true },
    price: { type: Number, required: true },
    image: { type: String, required: true },
    category: { type: String, default: 'Uncategorized' },
    description: { type: String, default: '' },
    quantity: { type: Number, default: 0 },
    source: {
      type: String,
      enum: ['manual', 'fakestore', 'dummyjson', 'platzi', 'api'],
      default: 'manual'
    },
    externalId: {
      type: String,
      unique: true,
      sparse: true,
    },
    rating: { type: Number, default: 0, min: 0, max: 5 },
    discount: { type: Number, default: 0, min: 0, max: 100 },
  },
  { timestamps: true }
);

const productModel = mongoose.model("Product", productSchema);
export default productModel;
```

Concepts:
- Defining schemas with field types, defaults, enums, min/max.
- `timestamps: true` → automatic `createdAt` and `updatedAt`.
- Models (`mongoose.model`) map to MongoDB collections.


2) Schema Middleware (Hooks)
----------------------------

File: `Backend/models/user.model.js`

```js
// Pre-save middleware to hash password before saving
userSchema.pre("save", async function (next) {
  if (!this.isModified("password")) {
    return next();
  }

  try {
    const salt = await bcrypt.genSalt(10);
    this.password = await bcrypt.hash(this.password, salt);
    next();
  } catch (error) {
    next(error);
  }
});
```

Concepts:
- **Mongoose pre-save hook** (`pre('save')`)
- Automatically hashing passwords before saving
- `this.isModified("password")` to avoid re-hashing unchanged passwords


3) Schema Methods
-----------------

File: `Backend/models/user.model.js`

```js
// Method to compare password for login
userSchema.methods.comparePassword = async function (candidatePassword) {
  try {
    return await bcrypt.compare(candidatePassword, this.password);
  } catch (error) {
    throw new Error(error);
  }
};

// Method to get user object without sensitive data
userSchema.methods.toJSON = function () {
  const user = this.toObject();
  delete user.password;
  delete user.resetPasswordToken;
  delete user.resetPasswordExpire;
  return user;
};
```

Concepts:
- **Instance methods** on Mongoose models
- Encapsulating logic like password checking and safe serialization


4) Virtuals
-----------

File: `Backend/models/review.model.js`

```js
const reviewSchema = new mongoose.Schema({
  // ... fields ...
}, { timestamps: true });

reviewSchema.virtual("reviewAge").get(function () {
  const now = new Date();
  const diff = now - this.createdAt;
  const days = Math.floor(diff / (1000 * 60 * 60 * 24));
  return `${days} days ago`;
});
```

Concepts:
- **Virtual properties** (`schema.virtual`) that are computed from existing data
- Not stored in MongoDB, but available on documents


5) Transactions & Sessions
--------------------------

Files:
- `Backend/Controller/order_controller.js` → `createOrder`
- `Backend/Controller/product_controller.js` → `updateProduct` (when quantity changes)

```js
const session = await mongoose.startSession();

try {
  await session.withTransaction(async () => {
    // Multiple queries/updates using { session }
  });
} finally {
  session.endSession();
}
```

Concepts:
- **MongoDB multi-document transactions**
- **Sessions** in Mongoose
- ACID properties for critical flows (orders + stock + notifications)


6) Authentication & Authorization (JWT + Middleware)
----------------------------------------------------

Files:
- `Backend/Controller/auth_controller.js`
- `Backend/middleware/auth.middleware.js`
- `Backend/middleware/admin.middleware.js`

Example: JWT token generation in `auth_controller.js`

```js
const generateToken = (id) => {
  return jwt.sign({ id }, process.env.JWT_SECRET, {
    expiresIn: process.env.JWT_EXPIRE || "30d",
  });
};
```

Example: Protect middleware (`auth.middleware.js`)

```js
export const protect = async (req, res, next) => {
  let token;

  if (req.cookies.token) {
    token = req.cookies.token;
  } else if (req.headers.authorization && req.headers.authorization.startsWith("Bearer")) {
    token = req.headers.authorization.split(" ")[1];
  }

  if (!token) {
    return res.status(401).json({ success: false, message: "Not authorized" });
  }

  const decoded = jwt.verify(token, process.env.JWT_SECRET);
  req.user = await User.findById(decoded.id);
  next();
};
```

Example: Admin check (`admin.middleware.js`)

```js
export const isAdmin = (req, res, next) => {
  if (!req.user || req.user.role !== "admin") {
    return res.status(403).json({
      success: false,
      message: "Access denied. Admin privileges required.",
    });
  }
  next();
};
```

Concepts:
- JWT-based authentication
- Middleware chaining in Express
- Role-based authorization (admin, user)


7) Password Hashing (bcrypt)
----------------------------

File: `Backend/models/user.model.js`

```js
import bcrypt from "bcryptjs";

// Inside pre-save hook
const salt = await bcrypt.genSalt(10);
this.password = await bcrypt.hash(this.password, salt);
```

Concepts:
- Hashing passwords using bcrypt
- Salt + hash for security


8) File Uploads (Multer) - Local & Cloud
----------------------------------------

Files:
- Local: `Backend/Config/multer-local.js`, `Backend/Controller/upload_controller_local.js`
- Cloudinary: `Backend/Config/cloudinary.js`, `Backend/Controller/upload_controller.js`
- Routes: `Backend/Routes/upload_routes.js`

Example: Local storage config (`multer-local.js`)

```js
const storage = multer.diskStorage({
  destination: function (req, file, cb) {
    cb(null, uploadDir);
  },
  filename: function (req, file, cb) {
    const uniqueSuffix = Date.now() + '-' + Math.round(Math.random() * 1E9);
    const ext = path.extname(file.originalname);
    cb(null, `avatar-${req.user._id}-${uniqueSuffix}${ext}`);
  }
});
```

Example: Controller (`upload_controller_local.js`)

```js
// Update user avatar with new local file path (relative URL)
user.avatar = `/uploads/avatars/${req.file.filename}`;
await user.save();
```

Concepts:
- Multer middleware for handling `multipart/form-data`
- Disk storage vs Cloud storage (Cloudinary)
- Linking file paths/URLs to MongoDB documents


9) Real-time Communication (Socket.IO)
--------------------------------------

Files:
- `Backend/Config/socket.js`
- `Backend/services/socket.service.js`
- Used in controllers: `order_controller.js`, `product_controller.js`, `notification_controller.js`, `promotion_controller.js`

Example: `socket.service.js`

```js
class SocketService {
  notifyOrderCreated(order, userId) {
    io.to(`user:${userId}`).emit('order:created', order);
  }

  notifyOrderStatusChanged(order) {
    io.to(`user:${order.userId}`).emit('order:status-changed', order);
  }

  notifyLowStock(product) {
    io.to('admin').emit('product:low-stock', product);
  }

  notifyOutOfStock(product) {
    io.to('admin').emit('product:out-of-stock', product);
  }
}
```

Concepts:
- WebSockets for real-time notifications
- Rooms (`user:<id>`, `admin`) for targeted messages
- Event-driven architecture


10) Express Middleware & Routing
--------------------------------

Files:
- `Backend/server.js`
- `Backend/Routes/*.js`

Example: `server.js`

```js
app.use(express.json());
app.use(cookieParser());

app.use("/api/products", productRoutes);
app.use("/api/orders", orderRoutes);
app.use("/api/reviews", reviewRoutes);
app.use("/api/auth", authRoutes);
app.use("/api/users", uploadRoutes);
```

Concepts:
- Express app setup
- JSON body parsing
- Cookie parsing
- Route mounting with prefixes


11) Sessions & Passport (Social Login)
--------------------------------------

Files:
- `Backend/Config/passport.js`
- `Backend/Routers/social_auth_routes.js`
- `Backend/server.js` (session + passport setup)

Example: `server.js`

```js
app.use(
  session({
    secret: process.env.SESSION_SECRET || "your-session-secret-key",
    resave: false,
    saveUninitialized: false,
    cookie: {
      secure: process.env.NODE_ENV === "production",
      maxAge: 24 * 60 * 60 * 1000,
    },
  })
);

app.use(passportConfig.initialize());
app.use(passportConfig.session());
```

Concepts:
- Express sessions
- Passport.js for OAuth (Google, Facebook, GitHub)
- Session-based authentication for social logins


12) Environment Variables & Config
----------------------------------

Files:
- `Backend/server.js` (dotenv + .env loading)
- `Backend/Config/db.js` (MONGO_URI)
- `Backend/Config/cloudinary.js` (Cloudinary env vars)

Example:

```js
import dotenv from "dotenv";
import path from "path";
import { fileURLToPath } from "url";

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

dotenv.config({ path: path.join(__dirname, '.env') });
```

Concepts:
- Using `.env` files for secrets and config
- Loading configuration based on environment


13) Summary
-----------

MongoDB / Mongoose concepts used:
- Schemas & Models
- Validation (required, enum, min/max)
- Timestamps
- Middleware (pre-save)
- Instance methods
- Virtuals
- Transactions & Sessions

Node.js / Express concepts used:
- Middleware (auth, admin, error handling pattern)
- Routing and route grouping
- Sessions & Passport
- JWT authentication
- File uploads with Multer
- Real-time communication with Socket.IO
- Environment-based configuration

This project showcases a **full-stack, production-style Node.js + MongoDB application** using many best-practice concepts in a real e-commerce context.
