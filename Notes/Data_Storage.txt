DATA STORAGE IN THIS PROJECT
=============================

0) Quick answers to your questions
----------------------------------

1. **Where is data stored? Atlas or where?**  
  - All structured app data (users, products, orders, reviews, notifications, settings) is stored in **MongoDB** using Mongoose.  
  - The exact place (cloud vs local) is controlled by `MONGO_URI` in `Backend/.env`. In your current setup, `MONGO_URI` points to a **MongoDB Atlas cluster**, so data is stored **in the cloud on Atlas**.

2. **If data is in the cloud (Atlas), why did we use Atlas?**  
  - Atlas is a **managed cloud database service** from MongoDB.  
  - It gives you: easy deployment, automatic backups, high availability, secure remote access, and production‑ready features without you managing servers yourself.  
  - This matches your goal of building a project that looks and behaves like a **real deployed e‑commerce app**, not just a local demo.


1) Primary database: MongoDB (Atlas or local)
--------------------------------------------

File: `Backend/Config/db.js`

```js
import mongoose from "mongoose";

export const connectDB = async () => {
  try {
    const conn = await mongoose.connect(process.env.MONGO_URI);
    console.log(` Database connected: ${conn.connection.host}`);
  } catch (error) {
    console.error(" Database connection failed:", error.message);
    process.exit(1);
  }
};
```

- The application connects to MongoDB using **Mongoose** and the `MONGO_URI` environment variable.
- If you set `MONGO_URI` to a **MongoDB Atlas connection string**, data is stored in **MongoDB Atlas (cloud)**.
- If you set `MONGO_URI` to a local MongoDB URL (e.g., `mongodb://localhost:27017/ecommerce`), data is stored **locally on your machine**.

**CRITICAL: Database name in URI**
- Your `MONGO_URI` must include the database name after `.mongodb.net/`.
- Example: `mongodb+srv://user:pass@cluster.mongodb.net/ecommerce?appName=...`
- The `/ecommerce` part tells Mongoose which database to use.
- Without it, Mongoose defaults to the `test` database, and your collections will be scattered!

**Conclusion:**
- The project is designed to work with **either** MongoDB Atlas **or** a local MongoDB instance, depending on how `MONGO_URI` is configured in `.env`.
- In your real `.env` for this project, `MONGO_URI` is set to a **MongoDB Atlas connection string**, so **all application data is currently stored in Atlas (cloud)**.


2) What data is stored in MongoDB?
---------------------------------

These Mongoose models define collections in MongoDB:

- `Backend/models/user.model.js` → `users` collection
- `Backend/models/product.model.js` → `products` collection
- `Backend/models/order.model.js` → `orders` collection
- `Backend/models/review.model.js` → `reviews` collection
- `Backend/models/notification.model.js` → `notifications` collection
- `Backend/models/settings.model.js` → `settings` collection

Example: `Backend/models/product.model.js`

```js
import mongoose from "mongoose";

const productSchema = new mongoose.Schema(
  {
    name: { type: String, required: true },
    price: { type: Number, required: true },
    image: { type: String, required: true },
    category: { type: String, default: 'Uncategorized' },
    description: { type: String, default: '' },
    quantity: { type: Number, default: 0 },
    source: {
      type: String,
      enum: ['manual', 'fakestore', 'dummyjson', 'platzi', 'api'],
      default: 'manual'
    },
    externalId: {
      type: String,
      unique: true,
      sparse: true
    },
    // ... more fields ...
  },
  { timestamps: true }
);

const productModel = mongoose.model("Product", productSchema);
export default productModel;
```

All product documents are stored in MongoDB, under the database specified by `MONGO_URI`.


3) File storage: avatars (profile pictures)
------------------------------------------

There are **two ways** your project can store avatar images:

A) Local file storage (current setup in routes)

File: `Backend/Config/multer-local.js`

```js
import multer from 'multer';
import path from 'path';
import { fileURLToPath } from 'url';
import fs from 'fs';

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

// Create uploads directory if it doesn't exist
const uploadDir = path.join(__dirname, '../uploads/avatars');
if (!fs.existsSync(uploadDir)) {
  fs.mkdirSync(uploadDir, { recursive: true });
}

const storage = multer.diskStorage({
  destination: function (req, file, cb) {
    cb(null, uploadDir);
  },
  filename: function (req, file, cb) {
    const uniqueSuffix = Date.now() + '-' + Math.round(Math.random() * 1E9);
    const ext = path.extname(file.originalname);
    cb(null, `avatar-${req.user._id}-${uniqueSuffix}${ext}`);
  }
});

const upload = multer({
  storage: storage,
  limits: { fileSize: 5 * 1024 * 1024 },
  fileFilter: (req, file, cb) => {
    if (file.mimetype.startsWith('image/')) {
      cb(null, true);
    } else {
      cb(new Error('Only image files are allowed!'), false);
    }
  },
});

export default upload;
```

Route: `Backend/Routes/upload_routes.js`

```js
import upload from "../Config/multer-local.js";
import { uploadAvatar, deleteAvatar } from "../Controller/upload_controller_local.js";

router.post("/avatar", upload.single('avatar'), uploadAvatar);
router.delete("/avatar", deleteAvatar);
```

Controller: `Backend/Controller/upload_controller_local.js`

```js
// Update user avatar with new local file path (relative URL)
user.avatar = `/uploads/avatars/${req.file.filename}`;
await user.save();
```

- Actual image files are stored on disk in: `Backend/uploads/avatars/`
- MongoDB only stores the **path** (e.g., `/uploads/avatars/avatar-123-xyz.jpg`) in the `avatar` field of the user document.


B) Cloud storage via Cloudinary (alternative option)

File: `Backend/Config/cloudinary.js`

```js
import { v2 as cloudinary } from "cloudinary";
import { CloudinaryStorage } from "multer-storage-cloudinary";
import multer from "multer";

cloudinary.config({
  cloud_name: process.env.CLOUDINARY_CLOUD_NAME,
  api_key: process.env.CLOUDINARY_API_KEY,
  api_secret: process.env.CLOUDINARY_API_SECRET,
});

const storage = new CloudinaryStorage({
  cloudinary: cloudinary,
  params: {
    folder: "ecommerce/avatars",
    allowed_formats: ["jpg", "jpeg", "png", "gif", "webp"],
    transformation: [
      { width: 500, height: 500, crop: "fill", gravity: "face" },
      { quality: "auto" },
      { fetch_format: "auto" },
    ],
  },
});

const upload = multer({
  storage: storage,
  limits: { fileSize: 5 * 1024 * 1024 },
  fileFilter: (req, file, cb) => {
    if (file.mimetype.startsWith("image/")) {
      cb(null, true);
    } else {
      cb(new Error("Only image files are allowed!"), false);
    }
  },
});

export { cloudinary, upload };
export default upload;
```

Controller: `Backend/Controller/upload_controller.js`

```js
// Update user avatar with new Cloudinary URL
user.avatar = req.file.path;
await user.save();
```

- In this mode, the actual image is stored in **Cloudinary (cloud)**.
- MongoDB stores the **Cloudinary URL** (e.g., `https://res.cloudinary.com/.../ecommerce/avatars/abc123.jpg`).

**Conclusion for avatars:**
- You support **both** local disk storage and Cloudinary.
- Currently, `upload_routes.js` is wired to use the **local storage** controller (`upload_controller_local.js`), but you can switch to Cloudinary by changing imports.


4) Summary
----------

- **Structured data** (users, products, orders, reviews, notifications, settings) → stored in **MongoDB** (Atlas or local based on `MONGO_URI`).
- **Avatar images** (profile pictures) → stored either:
  - On **local disk** in `Backend/uploads/avatars/` (current route wiring), with only the path stored in MongoDB; or
  - In **Cloudinary** (cloud CDN), with only the URL stored in MongoDB.

Your project is flexible: database location (local vs Atlas) and file storage (local vs Cloudinary) are controlled by configuration, not hard-coded.


5) Why use MongoDB Atlas instead of only local MongoDB?
-------------------------------------------------------

Even though you *could* point `MONGO_URI` to a local database like `mongodb://localhost:27017/ecommerce`, you chose Atlas for several important reasons:

1. **Remote access & collaboration**  
   - With Atlas, your database lives in the cloud.  
   - You (or your teammates) can connect from different machines without copying a local database around.  
   - This is especially useful for a project that you want to deploy or show from different environments (laptop, college lab, home PC, etc.).

2. **Deployment‑ready like a real app**  
   - Real e‑commerce apps don’t keep their main database only on a single laptop.  
   - Using Atlas makes your project closer to **real‑world production architecture**:  
     - Backend on a server (or render/vercel/railway)  
     - Database on a managed cloud database (Atlas)

3. **No need to manage MongoDB server manually**  
   - With local MongoDB, you must install, update, start/stop the MongoDB server yourself.  
   - With Atlas, MongoDB Inc. manages the underlying servers for you:  
     - You just connect using a URL.  
     - No need to worry about OS‑level setup, service restarts, or upgrades.

4. **Built‑in backups, monitoring, and scaling**  
   - Atlas gives you (even on free tier):  
     - Basic **backups/snapshots**.  
     - Web dashboard with **charts and monitoring** (connections, queries, storage).  
     - Easy options to **scale up** (more RAM/CPU/storage) if your app grows.  
   - Doing all this by yourself on a local MongoDB instance is much harder.

5. **Security & network features**  
   - Atlas supports:  
     - IP whitelisting (only allow certain IPs to connect).  
     - Built‑in TLS/SSL (encrypted connections).  
     - Easy user/role management.  
   - This helps you learn **secure cloud database patterns**, which is valuable for real jobs and projects.

6. **Good for learning + portfolio**  
   - Using Atlas lets you say:  
     > "This project uses a cloud‑hosted MongoDB Atlas cluster, similar to how production apps are deployed."
   - This sounds much stronger than "it only works with MongoDB installed on my laptop".
